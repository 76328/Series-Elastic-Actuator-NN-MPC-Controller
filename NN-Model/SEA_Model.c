#include "Model.h"
#include "math.h"

NN_MODEL PredictModel;

	float32_t IW[30][10]={{0.0285937,0.0284657,0.0284178,0.0283979,0.028383,0.00637333,0.00682571,0.00659427,0.00719126,0.00724479},
{0.0448808,0.0453444,0.0455422,0.0456554,0.0457682,0.00209135,0.00106893,0.000456994,0.000636042,0.000699061},
{0.0322295,0.0323407,0.0323986,0.0324414,0.0324829,-0.000331583,-0.000215451,6.24e-05,0.0014103,0.00212641},
{-0.0148993,-0.0150478,-0.0151158,-0.015158,-0.0151974,-0.00103068,-0.00110428,-0.000916431,-0.000742597,-6.95e-05},
{0.00423555,0.00383042,0.00367226,0.00360333,0.00354871,0.00728368,0.0102283,0.0114447,0.00803161,0.00635971},
{0.0328558,0.0332999,0.0334872,0.0335898,0.0336852,0.00116389,0.000899907,-0.000309783,-0.00133491,-0.00322517},
{0.0303936,0.0318963,0.0325351,0.0328915,0.03323,-0.00136692,-0.00109619,-0.000858276,-0.0009412,-0.00147641},
{0.0278447,0.028181,0.0283248,0.0284062,0.0284839,0.00126785,0.000647985,0.000352175,1.76e-06,-0.000876319},
{0.0236813,0.0252099,0.0258655,0.026239,0.0265958,0.000341531,0.00140843,0.00170717,0.00196493,0.00129509},
{-0.05204,-0.0522776,-0.0523947,-0.0524733,-0.0525445,-0.00113686,-0.0020917,-0.0014929,-6.36e-05,0.00353577},
{0.0241692,0.024605,0.0248048,0.0249309,0.0250546,-0.000144375,-0.000784327,-0.000665667,-0.000213617,0.000510563},
{-0.0204301,-0.0209884,-0.0212303,-0.0213699,-0.0215023,-0.000688125,-0.000751319,-0.000798461,-0.000712468,-0.000524335},
{-0.0197028,-0.0199853,-0.0201087,-0.0201802,-0.0202474,-0.0016101,-0.00117688,-0.00096521,-0.000858095,-0.000783193},
{-0.0166176,-0.0175647,-0.0179862,-0.0182359,-0.0184735,-0.000315576,-2.06e-05,0.00024938,0.000399501,-0.000714198},
{0.0170496,0.0180021,0.0184217,0.0186661,0.0188955,0.000426383,4.32e-05,-0.000181938,-0.000230112,0.000483496},
{0.018124,0.0185357,0.018716,0.0188212,0.0189199,0.000699804,0.000932172,0.000962253,0.000737721,-2.38e-05},
{0.0180445,0.0188502,0.0192015,0.0194047,0.0195951,0.00118049,2.53e-05,-0.000134015,0.000266656,0.000888553},
{0.0230187,0.0237512,0.0240838,0.0242925,0.0245029,-0.00373015,-0.00531163,-0.00506587,-0.00371629,-0.00162439},
{-0.0185208,-0.0201481,-0.020854,-0.02126,-0.0216456,-0.00110573,-0.000965695,-0.00106531,-0.000561781,-0.00156855},
{0.0192682,0.0209863,0.0217279,0.0221537,0.0225585,0.00122884,0.0018954,0.00218418,0.00203381,0.00176965},
{0.00439558,0.00444222,0.00446352,0.00447644,0.00448854,0.00160216,0.00144659,0.00129485,0.00121006,0.00107946},
{0.0320123,0.0322471,0.0323596,0.0324336,0.0325028,0.000689514,0.00136223,0.0011337,0.000609449,-0.00131152},
{0.0278276,0.0286952,0.0290641,0.0292718,0.0294698,-0.000861928,-0.000533329,-0.00015389,-0.000244914,-0.000989314},
{0.0305729,0.0317447,0.0322407,0.0325178,0.0327817,-0.00150322,-0.00104215,-0.000624215,-0.000698456,-0.00180784},
{-0.0212269,-0.0215941,-0.0217483,-0.0218283,-0.0218963,-0.010067,-0.0122092,-0.0133126,-0.0115198,-0.0115142},
{-0.00830371,-0.00837872,-0.00841274,-0.00843322,-0.00845218,-0.00154846,-0.00132342,-0.0010877,-0.000950527,-0.0006741},
{0.0114978,0.0116065,0.0116559,0.0116859,0.0117138,0.00136204,0.00114251,0.00087607,0.000738241,0.000322329},
{0.0263119,0.0264431,0.0265076,0.0265524,0.0265953,-8.24e-06,0.000556673,0.000716424,0.00109458,0.000813766},
{-0.0165038,-0.01635,-0.0162955,-0.0162756,-0.0162615,-0.00985941,-0.00998879,-0.00976245,-0.0104312,-0.0108035},
{0.0150891,0.0152271,0.0152905,0.0153302,0.0153673,0.00094677,0.00119014,0.00106758,0.000865827,0.000173587},
};

float32_t LW2[30]={-0.831774,0.332997,1.0208,-0.495663,-0.635378,0.306526,0.773735,0.178639,0.766047,-0.640235,0.529841,
-0.284469,-0.147848,-0.676765,0.621842,0.244297,0.453027,0.610063,-0.827424,0.858941,0.0364811,
0.546949,0.441038,0.611805,-0.738465,-0.146483,0.299269,0.927506,0.591294,0.858591};

float32_t B1[30]={-1.56115,1.45438,-1.36596,1.24911,-1.12345,1.0189,0.931331,0.804035,0.711744,0.626918,-0.51788,
-0.367669,-0.262,0.202107,-0.087316,0.0403949,0.135562,-0.307569,-0.366498,0.47599,-0.593094,
-0.728184,0.809133,0.923429,1.04971,1.13384,-1.24438,-1.36477,1.45256,-1.57275};

float32_t B2=0.0904913909010836;

static double tansig(double in)
{
    double out;
    out = (2 / (1 + exp(-2 * in))) - 1;
    return out;
}

static float myexp(float x)
{
  x=1.0+x/256;
	x*=x;
	x*=x;
	x*=x;
	x*=x;
	x*=x;
	x*=x;
	x*=x;
	x*=x;
	return x;
}

void _FF_GetNextOutput(NN_MODEL *p)
{
    float aux = 0;
    float aux_hlast = 0;
    float aux2 = 0;
		int i=0,j=0;
    for (i = 0; i < HNUM; i++)
    {
        aux = 0;
        for (j = 0; j < INNUM; j++)
        {  
            aux = aux + p->IW[i][j] * p->input[j];	
        }
        p->haux[i] = aux;
    }
    for (i = 0; i < HNUM; i++)
    {   
        aux2 = p->haux[i] + p->B1[i];
        p->h[i] =(2 / (1 + myexp(-2 * aux2))) - 1;
    }

    aux = 0;
    for (i = 0; i < HNUM; i++)
    {
        aux = p->h[i] * p->LW2[i] + aux;
    }
    p->out = aux + p->B2;
}


void module_model_init()
{

		int i=0,j=0;
		for(i=0;i<10;i++)
		{
			PredictModel.input[i]=0;
		}
		for(i=0;i<30;i++)
		{
			PredictModel.h[i]=0;
		}
		PredictModel.out=0;
		
		for( i=0;i<30;i++)
		{
			for(j=0;j<10;j++)
			{
				PredictModel.IW[i][j]=IW[i][j];
			}
		}
		
		for(i=0;i<30;i++)
		{
			PredictModel.LW2[i]=LW2[i];
		}
		
		for(i=0;i<30;i++)
		{
			PredictModel.B1[i]=B1[i];
		}
		PredictModel.B2=B2;
		PredictModel.FF_GetNextOutput=_FF_GetNextOutput;
}
